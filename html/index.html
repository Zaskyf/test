<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Магазин</title>
    
    <link rel="stylesheet" href="/css/style.css">
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@8/swiper-bundle.min.css"
/> <!--Ссылка на иконки в регистрации -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css"
        integrity="sha512-SzlrxWUlpfuzQ+pcUCosxcglQRNAq/DZjVsC0lE40xsADsfeQoEypE+enwcOiGjk/bSuGGKHEyjSoQ1zVisanQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

       
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
      
</head>
<body>
    <header>
            <div class="header-contaner">
                <button id="menuBurger" class="cat"><i class="fas fa-bars"></i> Каталог <div class="catalog-icon"  > 
        
    </div></button>
                <div class="search-bar">
                    <input type="search" name="search" placeholder="Поиск товаров">
                    <button type="submit">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
                <div class="cart-icon" onclick="toggleCart()">
                    <i class="fas fa-shopping-cart"></i>
                </div>
              <div class="header-contaner">
            <div class="account-icon" onclick="toggleAccount()">
                <i class="fas fa-user"></i>
            </div>
 </div>
 </div>
        </header>

        <div class="cart" id="cart">
            <h2  class= "two">Корзина</h2>
            <div id="cart-items"></div>
          <a href="cart.html" target="_blank" rel="noopener noreferrer" class= "cartbu" >Перейти в корзину</a>
          <!--  <a    href="cart.html" class= "cartbu">Перейти в корзину</a>  Почему ссылка не работает -->
            
            <button class= "cartbu" onclick="clearCart()">Очистить корзину</button>
        </div>

        <!--Каталог-->

            <div class="catalog" id="catalog">
        <h6>Каталог</h6>
      
      <a href="wallpaper.html" style = " text-decoration :none;  color:black;"> <button class="category-button" data-category="1">
        <span>Обои</span> <i class="fas fa-chevron-right"></i>
    </button>  </a>
        <a href="categorysantexnica.html" style = " text-decoration :none;  color:black;"> <button class="category-button" data-category="2">
            <span>Сантехника</span> <i class="fas fa-chevron-right"></i>
        </button>  </a>
        <a href="floor.html" style = " text-decoration :none;  color:black;"> <button class="category-button" data-category="3">
            <span>Напольные покрытия</span> <i class="fas fa-chevron-right"></i>
        </button>  </a>
        <a href="furniture.html" style = " text-decoration :none;  color:black;"> <button class="category-button" data-category="4">
            <span>Мебель</span> <i class="fas fa-chevron-right"></i>
        </button>  </a>
        <a href="dishes.html" style = " text-decoration :none;  color:black;"> <button class="category-button" data-category="5">
            <span>Посуда</span> <i class="fas fa-chevron-right"></i>
        </button>  </a>
        <a href="textile.html" style = " text-decoration :none;  color:black;"> <button class="category-button" data-category="6">
            <span>Текстиль</span> <i class="fas fa-chevron-right"></i>
        </button>  </a>
        <a href="householdappliances.html" style = " text-decoration :none;  color:black;"> <button class="category-button" data-category="7">
            <span>Бытовая техника</span> <i class="fas fa-chevron-right"></i>
        </button>  </a>
        <a href="decor.html" style = " text-decoration :none;  color:black;"> <button class="category-button" data-category="8">
            <span>Декор</span> <i class="fas fa-chevron-right"></i>
        </button>  </a>
        <a href="tools.html" style = " text-decoration :none;  color:black;"> <button class="category-button" data-category="9">
            <span>Инструменты</span> <i class="fas fa-chevron-right"></i>
        </button>  </a>

                                          
    </div>

    <!-- Popup для подкатегорий -->
    <div class="popup" id="popup">
        <span class="clobutton" onclick="closePopup()">&times;</span>
      <h2 id="popupTitle"  class="popupTitle"></h2>  
       

        <ul id="popupContent"></ul>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js"></script>
    
<!-- НАЧАЛО РЕГИСТРАЦИИ  -->
<div class="account" id="account" onmouseleave="hideAccount()">
    <h2 class="two">Аккаунт</h2>
    <button class="sign" id="signButton" onclick="openRegisterModal()">Войти или Зарегистрироваться</button>
</div>

<!-- Модальное окно для регистрации -->
<div id="registerModal" class="modal">
    <span class="close" onclick="closeRegisterModal()">&times;</span> <!-- Крестик закрытия -->
    <div class="modal-content sign-in">
        <form id="loginForm" action="">
            <h2 style="color: white;" class="two">Войти</h2>
            <div class="input-group">
                <input type="email" id="loginEmail" required> <!-- Добавила еще поле email -->
                <label for="loginEmail">Email</label>
            </div>
            <div class="input-group">
                <input type="password" id="loginPassword" required>
                <label for="loginPassword">Пароль</label>
            </div>
            <div class="remember">
                <label><input type="checkbox"> Запомнить меня</label>
            </div>
            <button class="registr" type="submit">Войти</button>
            <div class="signUp-link">
                <p class="two">У вас нет аккаунта? <a href="#" style="color: white;" class="signUpBtn-link">Регистрация</a></p>
            </div>
        </form>
    </div>
    <div class="modal-content sign-up">
        <form id="registerForm" action="">
            <h2 style="color: white;" class="two">Регистрация</h2><br>
            <div class="input-group">
                <input type="text" id="registerFirstName" required>
                <label for="registerFirstName">Имя</label>
            </div>
            <div class="input-group">
                <input type="text" id="registerLastName" required> <!-- Добавила еще  поле фамилии -->
                <label for="registerLastName">Фамилия</label>
            </div>
            <div class="input-group">
                <input type="email" id="registerEmail" required> <!-- Добавила еще поле email -->
                <label for="registerEmail">Email</label>
            </div>
            <div class="input-group">
                <input type="password" id="registerPassword" required>
                <label for="registerPassword">Придумайте пароль</label>
            </div>
            <div class="input-group">
                <input type="password" id="registerRepeatPassword" required> <!-- Добавила еще  поле повторения пароля -->
                <label for="registerRepeatPassword">Повторите пароль</label>
            </div>
            <div class="remember">
                <label style="color: white;" class="two">
                    <input type="checkbox"> Я соглашаюсь с чем-то
                </label>
            </div>
            <button class="registr" type="submit">Зарегистрироваться</button>
            <div class="signUp-link">
                <p style="color: white;" class="two">У Вас уже есть аккаунт?
                    <a style="color: white;" href="#" class="signInBtn-link">Войти</a>
                </p>
                <div class="gogle" type="button" onclick="socialLogin()" style="color: white;">Войти через <span class="social-link">соцсети</span></div>
            </div>
            <div class="tooltip" id="tooltip">
                <span class="clo" onclick="hideTooltip()">&#10006;</span>
                <ul style="text-align:left; padding:5px; margin-top:10px;">
                    <li>
                        <a href="#" style="margin-right: 3px; color: black; display: inline-block;">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                    </li>
                    <li>
                        <a href="#" style="margin-right: 3px; color: black; display: inline-block;">
                            <i class="fab fa-google"></i>
                        </a>
                    </li>
                    <li>
                        <a href="#" style="margin-right: 3px; color: black; display: inline-block;">
                            <i class="fab fa-instagram"></i>
                        </a>
                    </li>
                </ul>
            </div>
        </form>
    </div>
</div>
<!--КОНЕЦ РЕГИСТРАЦИИ-->

    </body>

</html>


<script>

    // Регистрация
    const socialLink = document.querySelector('.social-link');
    const tooltip = document.getElementById('tooltip');
    const account = document.getElementById('account');
    const registerModal = document.getElementById('registerModal');
    const registerForm = document.getElementById('registerForm');
    const loginForm = document.getElementById('loginForm');
    const signInBtnLink = document.querySelector('.signInBtn-link');
    const signUpBtnLink = document.querySelector('.signUpBtn-link');
    const signButton = document.getElementById('signButton');
    const modal = document.querySelector('.modal');
    let accountVisible = false;

    function hideTooltip() {
        tooltip.style.display = 'none';
    }

    function toggleAccount() {
        accountVisible = !accountVisible;
        account.style.display = accountVisible ? 'block' : 'none';
    }

    function hideAccount() {
        if (accountVisible) {
            accountVisible = false;
            account.style.display = 'none';
        }
    }

    function hideCart() {
        document.getElementById('cart').style.display = 'none';
    }

    function openRegisterModal() {
        document.body.style.overflow = 'hidden';
        registerModal.style.display = 'block';
    }

    function closeRegisterModal() {
        document.body.style.overflow = 'auto';
        registerModal.style.display = 'none';
    }

    // Обработчик для формы входа
    loginForm.onsubmit = async (event) => {
        event.preventDefault();

        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;

        try {
            const response = await fetch('api-auth/jwt/create', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ email, password }),
            });

            const data = await response.json(); 

            if (response.ok) {
                alert('Вход выполнен успешно');
                closeRegisterModal();
                localStorage.setItem('isLoggedIn', 'true');
                signButton.textContent = 'Перейти в личный кабинет';
                signButton.onclick = () => {
                    window.open('Kabinet.html', '_blank');
                };
            } else {
                // Обработка ошибок от сервера
                if (data.detail) {
                    alert(`Ошибка при входе: ${data.detail}`);
                } else {
                    alert('Ошибка при входе: Неизвестная ошибка');
                }
            }
        } catch (error) {
            console.error('Ошибка:', error);
            alert('Ошибка при входе: Проверьте подключение к интернету');
        }
    };

    // Обработчик для формы регистрации
    registerForm.onsubmit = async (event) => {
        event.preventDefault();

        const firstName = document.getElementById('registerFirstName').value;
        const lastName = document.getElementById('registerLastName').value;
        const email = document.getElementById('registerEmail').value;
        const password = document.getElementById('registerPassword').value;
        const repeatPassword = document.getElementById('registerRepeatPassword').value;

        // Проверка на совпадение паролей
        if (password !== repeatPassword) {
            alert('Пароли не совпадают');
            return;
        }

        try {
            const response = await fetch('api-core/api-register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ firstName, lastName, email, password }),
            });

            const data = await response.json(); 

            if (response.ok) {
                alert('Регистрация завершена');
                closeRegisterModal();
                localStorage.setItem('isLoggedIn', 'true');
                window.open('Kabinet.html', '_blank');
            } else {
                // Обработка ошибок от сервера
                if (data.detail) {
                    alert(`Ошибка при регистрации: ${data.detail}`);
                } else {
                    alert('Ошибка при регистрации: Неизвестная ошибка');
                }
            }
        } catch (error) {
            console.error('Ошибка:', error);
            alert('Ошибка при регистрации: Проверьте подключение к интернету');
        }
    };

    // Добавляем обработчики для переключения модального окна
    signUpBtnLink.addEventListener('click', () => {
        modal.classList.toggle('active'); // Переключаем активный класс
    });

    signInBtnLink.addEventListener('click', () => {
        modal.classList.toggle('active'); // Переключаем активный класс
    });






    //корзина
    function addToCart(button) {
        const productTitle = button.closest('.swiper-slide').querySelector('.product-title').textContent;
        const productPrice = button.closest('.swiper-slide').querySelector('.money span').textContent;
        const productQuantity = button.closest('.swiper-slide').querySelector('.js-number').value;
    
        const existingItem = Array.from(document.querySelectorAll('.cart-item'))
            .find(item => item.querySelector('p').textContent.includes(productTitle));
        if (existingItem) {
            const quantityInput = existingItem.querySelector('.js-number');
            quantityInput.value = parseInt(quantityInput.value) + parseInt(productQuantity);
        } else {
            const cartItem = document.createElement('div');
            cartItem.classList.add('cart-item');
            cartItem.innerHTML = `
                <p>${productTitle} - ${productPrice}</p>
                <button class='sub' style='margin-right:80px;' onclick='changeCartItemNumber(-1, this)'>–</button>
                <input type='text' class='js-number' value='${productQuantity}' readonly>
                <button class='ad' style='margin-right:30px;' onclick='changeCartItemNumber(1, this)'>+</button>
            `;
            document.getElementById('cart-items').appendChild(cartItem);
        }
    }
    function removeFromCart(button) {
    }
    function toggleCart() {
        const cart = document.getElementById('cart');
        cart.style.display = cart.style.display === 'none' ? 'block' : 'none';
    }
    function clearCart() {
        const cartItems = document.getElementById('cart-items');
        cartItems.innerHTML = '';
    }
    function deleteSelectedItems() {
        const checkboxes = document.querySelectorAll('.item-checkbox:checked');
        checkboxes.forEach(checkbox => {
            checkbox.closest('.cart-item').remove();
        });
    }
    // Закрытие корзины при уходе курсора мыши
    const cart = document.getElementById('cart');
    cart.addEventListener('mouseleave', () => {
        cart.style.display = 'none';
    });
    function clearCart() {
        document.getElementById('cart-items').innerHTML = '';
    }
    function changeCartItemNumber(step, button) {
        const input = button.parentElement.querySelector('.js-number');
        let value = parseInt(input.value);
        value += step;
        if (value < 1) {
            value = 1;
        }
        input.value = value;
    }
    let currentIndex1 = 0;
    const cards = document.querySelectorAll('.product-card');
    function showCards(startIndex) {
        const endIndex = startIndex + 5;
        cards.forEach((card, i) => {
            card.style.display = (i >= startIndex && i < endIndex) ? 'block' : 'none';
        });
    }
    showCards(currentIndex1);
    document.getElementById('nextBtn').addEventListener('click', () => {
        if (currentIndex1 + 5 >= cards.length) return;
        currentIndex1 += 5;
        showCards(currentIndex1);
    });
    document.getElementById('prevBtn').addEventListener('click', () => {
        if (currentIndex1 === 0) return;
        currentIndex1 -= 5;
        showCards(currentIndex1);
    });
    </script>



