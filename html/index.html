<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Магазин</title>
    
    <link rel="stylesheet" href="/css/style.css">
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@8/swiper-bundle.min.css"
/> <!--Ссылка на иконки в регистрации -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css"
        integrity="sha512-SzlrxWUlpfuzQ+pcUCosxcglQRNAq/DZjVsC0lE40xsADsfeQoEypE+enwcOiGjk/bSuGGKHEyjSoQ1zVisanQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

       
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">



<script src="/script.js/index.js"></script>
<script src="/script.js/cart.js"></script>
      
</head>
<body>
    <header>
            <div class="header-contaner">
                <button id="menuBurger" class="cat"><i class="fas fa-bars"></i> Каталог <div class="catalog-icon"  > 
        
    </div></button>
                <div class="search-bar">
                    <input type="search" name="search" placeholder="Поиск товаров">
                    <button type="submit">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
                <div class="cart-icon" onclick="toggleCart()">
                    <i class="fas fa-shopping-cart"></i>
                </div>
              <div class="header-contaner">
            <div class="account-icon" onclick="toggleAccount()">
                <i class="fas fa-user"></i>
            </div>
 </div>
 </div>
        </header>

        <div class="cart" id="cart">
            <h2  class= "two">Корзина</h2>
            <div id="cart-items"></div>
          <a href="cart.html" target="_blank" rel="noopener noreferrer" class= "cartbu" >Перейти в корзину</a>
          <!--  <a    href="cart.html" class= "cartbu">Перейти в корзину</a>  Почему ссылка не работает -->
            
            <button class= "cartbu" onclick="clearCart()">Очистить корзину</button>
        </div>

        <!--Каталог-->

            <div class="catalog" id="catalog">
        <h6>Каталог</h6>
      
      <a href="wallpaper.html" style = " text-decoration :none;  color:black;"> <button class="category-button" data-category="1">
        <span>Обои</span> <i class="fas fa-chevron-right"></i>
    </button>  </a>
        <a href="categorysantexnica.html" style = " text-decoration :none;  color:black;"> <button class="category-button" data-category="2">
            <span>Сантехника</span> <i class="fas fa-chevron-right"></i>
        </button>  </a>
        <a href="floor.html" style = " text-decoration :none;  color:black;"> <button class="category-button" data-category="3">
            <span>Напольные покрытия</span> <i class="fas fa-chevron-right"></i>
        </button>  </a>
        <a href="furniture.html" style = " text-decoration :none;  color:black;"> <button class="category-button" data-category="4">
            <span>Мебель</span> <i class="fas fa-chevron-right"></i>
        </button>  </a>
        <a href="dishes.html" style = " text-decoration :none;  color:black;"> <button class="category-button" data-category="5">
            <span>Посуда</span> <i class="fas fa-chevron-right"></i>
        </button>  </a>
        <a href="textile.html" style = " text-decoration :none;  color:black;"> <button class="category-button" data-category="6">
            <span>Текстиль</span> <i class="fas fa-chevron-right"></i>
        </button>  </a>
        <a href="householdappliances.html" style = " text-decoration :none;  color:black;"> <button class="category-button" data-category="7">
            <span>Бытовая техника</span> <i class="fas fa-chevron-right"></i>
        </button>  </a>
        <a href="decor.html" style = " text-decoration :none;  color:black;"> <button class="category-button" data-category="8">
            <span>Декор</span> <i class="fas fa-chevron-right"></i>
        </button>  </a>
        <a href="tools.html" style = " text-decoration :none;  color:black;"> <button class="category-button" data-category="9">
            <span>Инструменты</span> <i class="fas fa-chevron-right"></i>
        </button>  </a>

                                          
    </div>

    <!-- Popup для подкатегорий -->
    <div class="popup" id="popup">
        <span class="clobutton" onclick="closePopup()">&times;</span>
      <h2 id="popupTitle"  class="popupTitle"></h2>  
       

        <ul id="popupContent"></ul>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js"></script>
    
<!-- НАЧАЛО РЕГИСТРАЦИИ  -->
<div class="account" id="account" onmouseleave="hideAccount()">
    <h2 class="two">Аккаунт</h2>
    <button class="sign" id="signButton" onclick="openRegisterModal()">Войти или Зарегистрироваться</button>
</div>

<!-- Модальное окно для регистрации -->
<div id="registerModal" class="modal">
    <span class="close" onclick="closeRegisterModal()">&times;</span> <!-- Крестик закрытия -->
    <div class="modal-content sign-in">
        <form id="loginForm" action="">
            <h2 style="color: white;" class="two">Войти</h2>
            <div class="input-group">
                <input type="email" id="loginEmail" required> <!-- Добавила еще поле email -->
                <label for="loginEmail">Email</label>
            </div>
            <div class="input-group">
                <input type="password" id="loginPassword" required>
                <label for="loginPassword">Пароль</label>
            </div>
            <div class="remember">
                <label><input type="checkbox"> Запомнить меня</label>
            </div>
            <button class="registr" type="submit">Войти</button>
            <div class="signUp-link">
                <p class="two">У вас нет аккаунта? <a href="#" style="color: white;" class="signUpBtn-link">Регистрация</a></p>
            </div>
        </form>
    </div>
    <div class="modal-content sign-up">
        <form id="registerForm" action="">
            <h2 style="color: white;" class="two">Регистрация</h2><br>
            <div class="input-group">
                <input type="text" id="registerFirstName" required>
                <label for="registerFirstName">Имя</label>
            </div>
            <div class="input-group">
                <input type="text" id="registerLastName" required> <!-- Добавила еще  поле фамилии -->
                <label for="registerLastName">Фамилия</label>
            </div>
            <div class="input-group">
                <input type="email" id="registerEmail" required> <!-- Добавила еще поле email -->
                <label for="registerEmail">Email</label>
            </div>
            <div class="input-group">
                <input type="password" id="registerPassword" required>
                <label for="registerPassword">Придумайте пароль</label>
            </div>
            <div class="input-group">
                <input type="password" id="registerRepeatPassword" required> <!-- Добавила еще  поле повторения пароля -->
                <label for="registerRepeatPassword">Повторите пароль</label>
            </div>
            <div class="remember">
                <label style="color: white;" class="two">
                    <input type="checkbox"> Я соглашаюсь с чем-то
                </label>
            </div>
            <button class="registr" type="submit">Зарегистрироваться</button>
            <div class="signUp-link">
                <p style="color: white;" class="two">У Вас уже есть аккаунт?
                    <a style="color: white;" href="#" class="signInBtn-link">Войти</a>
                </p>
                <div class="gogle" type="button" onclick="socialLogin()" style="color: white;">Войти через <span class="social-link">соцсети</span></div>
            </div>
            <div class="tooltip" id="tooltip">
                <span class="clo" onclick="hideTooltip()">&#10006;</span>
                <ul style="text-align:left; padding:5px; margin-top:10px;">
                    <li>
                        <a href="#" style="margin-right: 3px; color: black; display: inline-block;">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                    </li>
                    <li>
                        <a href="#" style="margin-right: 3px; color: black; display: inline-block;">
                            <i class="fab fa-google"></i>
                        </a>
                    </li>
                    <li>
                        <a href="#" style="margin-right: 3px; color: black; display: inline-block;">
                            <i class="fab fa-instagram"></i>
                        </a>
                    </li>
                </ul>
            </div>
        </form>
    </div>
</div>
<!--КОНЕЦ РЕГИСТРАЦИИ-->

  <!-- Кнопка для переключения темы -->
  <div class="theme-switcher" onclick="toggleTheme()">
    <i class="fas fa-moon"></i> <!-- Иконка для темной темы -->
</div>



<!-- НАЧАЛО КАРУСЕЛИ -->

<div class="carousel">
<div class="itms">
<div class="itm active"><img src="https://www.ru-divan.ru/uploads/media/tissue/0001/91/a31f3761b7f7eb925a5cfce7e3f797dc2abbcf36.jpeg" > </div>
<div class="itm"><img src="https://www.solidbackgrounds.com/images/7680x4320/7680x4320-white-solid-color-background.jpg" > </div>
<div class="itm"><img src="https://www.ru-divan.ru/uploads/media/tissue/0001/91/a31f3761b7f7eb925a5cfce7e3f797dc2abbcf36.jpeg" > </div>
<div class="itm"><img src="https://www.solidbackgrounds.com/images/7680x4320/7680x4320-white-solid-color-background.jpg" > </div>
<div class="itm"><img src="https://www.ru-divan.ru/uploads/media/tissue/0001/91/a31f3761b7f7eb925a5cfce7e3f797dc2abbcf36.jpeg" > </div>
</div>
<div class="navig">
<button class="buprev">◀</button>
<button class="bunext">▶</button>
</div>
</div>
<!-- КОНЕЦ КАРУСЕЛИ-->



<!--НАЧАЛО ИКНОК ССЫЛОК НА ГЛАВНОЙ СТРАНИЦЕ-->
<section class="boxicon">
<a  class="bcontainer"  target="_blank" rel="noopener noreferrer"  href="category.html" style=" text-decoration: none;" >  <img class="icones" src="https://cdn-icons-png.flaticon.com/128/602/602287.png" alt="Ассортимент"> <p   class = "two ">Каталог</p>  </a>
<a   class="bcontainer"  target="_blank" rel="noopener noreferrer"  style="text-decoration: none;" href="Dostavka.html"><img class="icones" src="https://cdn-icons-png.flaticon.com/128/602/602287.png" alt="Доставка">  <p class = "two ">Доставка</p> </a> 
<a   class="bcontainer"   target="_blank" rel="noopener noreferrer"  style="text-decoration: none;" href=""><img class="icones" src="https://cdn-icons-png.flaticon.com/128/602/602287.png" alt="Гарантии">  <p   class = "two ">Гарантии</p> </a> 
<a   class="bcontainer"  target="_blank" rel="noopener noreferrer"  style="text-decoration: none;" href=""><img class="icones" src="https://cdn-icons-png.flaticon.com/128/602/602287.png" alt="Распродажа">  <p  class = "two " >Распродажа</p> </a> 
</section>
<!--КОНЕЦ ИКНОК ССЫЛОК НА ГЛАВНОЙ СТРАНИЦЕ-->




<!-- Слайдер с товарами-->
<section class="swiper">
<h6 class="two"  style =" font-size:40px;  margin-bottom: 20px;"> Распродажа</h6>
<div class="swiper-wrapper" id="swiper-wrapper">
</div>
<div class="swiper-button-prev prev"></div>
<div class="swiper-button-next next"></div>
</section>


<footer>
<hr>
<div class="containr"><div class="subscribe"></div><div class="footer_navigation">
<div class="footer_menu">
<div class="item"><div class="caption">Покупателям</div>
<ul class="menu_list">
<a href="/html/category.html">Каталог</a>
<a href="/about/arktika-servis/">Расрочка/Кредиты</a>
<a href="/about/bonus-program/">Бонусная программа</a>
<a href="/about/podarochnye-karty/">Подарочные карты</a>
</ul></div>
<div class="item"> 
<div class="caption">Информация</div>
<ul class="menu_list">
<a href="/information/oplata/">Как оплатить</a>
<a href="/information/feedback/">Обратная связь</a>
<a href="/information/jobs/">Гарантия качества </a>
<a href="contacts.html">Контакты</a>
</ul></div>   

 <div class="item"><div class="caption">Наши услуги</div>
<ul class="menu_list"><a href="dostavkatext.html">Доставка</a>
</ul>
</div>
</div>
 <div class="contact_info"><div class="phone"><a href="tel:8 (918) 827-20-12">8 (918) 827-20-12</a> (с 09:30 до 19:00) </div>
<div class="address">Адрес магазина:<br>ул. Астана Кесаева, 33"а, Владикавказ <br> Респ. Северная Осетия — Алания</div> 
<div class="copyright">© 1996—2024, ТК «Декор центр»  </div>
</div></div></div>

</footer>


<script>


// Регистрация

const socialLink = document.querySelector('.social-link');
const tooltip = document.getElementById('tooltip');
const account = document.getElementById('account');
const registerModal = document.getElementById('registerModal');
const registerForm = document.getElementById('registerForm');
const loginForm = document.getElementById('loginForm');
const signInBtnLink = document.querySelector('.signInBtn-link');
const signUpBtnLink = document.querySelector('.signUpBtn-link');
const signButton = document.getElementById('signButton');
const modal = document.querySelector('.modal');
let accountVisible = false;


//виден
function hideTooltip() {
    tooltip.style.display = 'none';
}
//переключение видимости
function toggleAccount() {
    accountVisible = !accountVisible;
    account.style.display = accountVisible ? 'block' : 'none';
}



//скрыть акк
function hideAccount() {
    if (accountVisible) {
        accountVisible = false;
        account.style.display = 'none';
    }
}

function hideCart() {
    document.getElementById('cart').style.display = 'none';
}

function openRegisterModal() {
    document.body.style.overflow = 'hidden';
    registerModal.style.display = 'block';
}

function closeRegisterModal() {
    document.body.style.overflow = 'auto';
    registerModal.style.display = 'none';
}

// Обработчик для формы регистрации
registerForm.onsubmit = async (event) => {

//чтобы страница не перезагружалась 
    event.preventDefault();


// Получаем значения полей формы регистрации (как в бэке + id на html)


    const firstName = document.getElementById('registerFirstName').value;
    const lastName = document.getElementById('registerLastName').value;
    const email = document.getElementById('registerEmail').value;
    const password = document.getElementById('registerPassword').value;
    const repeatPassword = document.getElementById('registerRepeatPassword').value;


//проверка паролей 
    if (password !== repeatPassword) {
        alert('Пароли не совпадают');
        return;
    }

    try {

// Отправляем POST-запрос на сервер для регистрации (может апи не то ?)

        const response = await fetch('/api-core/api-register', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json',
            },
            body: JSON.stringify({ 
                first_name: firstName, 
                last_name: lastName,
                email: email,
                password: password
            }),
        });

        // Проверяем, какой статус ответа
        if (!response.ok) {
            const text = await response.text(); // Получаем текст ответа
            console.error('Ошибка ответа сервера:', text); 
            throw new Error('Ошибка сервера: ' + response.status + ' ' + response.statusText);
        }
// Если ответ успешный, получаем данные из ответа
        const data = await response.json();
 // Выводим сообщение об успешной регистрации
        alert('Регистрация завершена');
// Закрываем модальное окно регистрации
        closeRegisterModal();
        localStorage.setItem('isLoggedIn', 'true');

// Открываем страницу кабинета в новой вкладке
        window.open('Kabinet.html', '_blank');

    } 
    
    //ошибки
    catch (error) {
        console.error('Ошибка регистрации:', error);
        if (error.name === 'TypeError' && error.message === 'Failed to fetch') {
            alert('Ошибка подключения: Проверьте интернет-соединение');
        } else {
            alert(`Ошибка регистрации: ${error.message || 'Неизвестная ошибка'}`);
        }
    }
};

// Обработчик для формы входа
loginForm.onsubmit = async (event) => {
    event.preventDefault();

    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;

    try {
        const response = await fetch('/api-core/api-login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json',
            },
            body: JSON.stringify({ 
              email: email,
              password: password
                
            }),
        });

        // Проверка  какой статус ответа
        if (!response.ok) {
            const text = await response.text(); // Получаем текст ответа
            console.error('Ошибка ответа сервера:', text); // ошибка текст ответа
            throw new Error('Ошибка сервера: ' + response.status + ' ' + response.statusText);
        }

        const data = await response.json();
        alert('Вход выполнен успешно');
        localStorage.setItem('isLoggedIn', 'true');
        window.open('Kabinet.html', '_blank');

    } catch (error) {
        console.error('Ошибка входа:', error);
        if (error.name === 'TypeError' && error.message === 'Failed to fetch') {
            alert('Ошибка подключения: Проверьте интернет-соединение');
        } else {
            alert(`Ошибка входа: ${error.message || 'Неизвестная ошибка'}`);
        }
    }
};


    // Добавение  обработчика для переключения модального окна (прокрутка регистрации )
    signUpBtnLink.addEventListener('click', () => {
        modal.classList.toggle('active'); // Переключение на  активный класс
    });

    signInBtnLink.addEventListener('click', () => {
        modal.classList.toggle('active'); // Переключение на  активный класс
    });



    </script>
